<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:147.0) Gecko/20100101 Firefox/147.0" version="29.3.2">
  <diagram name="TripleDES Key Generation Detailed" id="tdes-key-gen-flow-detailed">
    <mxGraphModel dx="1964" dy="1181" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="start" parent="1" style="ellipse;whiteSpace=wrap;html=1;fontStyle=1" value="начало" vertex="1">
          <mxGeometry height="50" width="120" x="640" y="70" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-7" edge="1" parent="1" source="check-support" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="error-unsupported">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-8" connectable="0" parent="YgZ0nsd0JDA4WT5Mb-KB-7" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="Нет" vertex="1">
          <mxGeometry relative="1" x="-0.337" y="-1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="check-support" parent="1" style="rhombus;whiteSpace=wrap;html=1;align=center;" value="Проверка того, что алгоритм поддерживается&amp;nbsp;" vertex="1">
          <mxGeometry height="75" width="230" x="585" y="165" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-9" edge="1" parent="1" source="error-unsupported" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" target="end">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="975" y="1180" />
              <mxPoint x="720" y="1180" />
            </Array>
            <mxPoint x="975" y="1540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="error-unsupported" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Бросок исключения:&lt;br&gt;UnsupportedAlgorithmError(algorithm,&lt;br&gt;&quot;TripleDesEncryptionService&quot;)&lt;/div&gt;" vertex="1">
          <mxGeometry height="77.5" width="210" x="870" y="165" as="geometry" />
        </mxCell>
        <mxCell id="check-algo-type" parent="1" style="rhombus;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Проверка типа алгоритма:&lt;br&gt;when (algorithm)&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="320" x="540" y="450" as="geometry" />
        </mxCell>
        <mxCell id="tdes-112-case" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Случай: TDES_112&lt;br&gt;&lt;br&gt;keySize = TDES_112_KEY_LENGTH&lt;br&gt;keySize = 16 байт&lt;br&gt;&lt;br&gt;Структура ключа:&lt;br&gt;K1 (8 байт) + K2 (8 байт)&lt;br&gt;= 16 байт = 112 бит&lt;/div&gt;" vertex="1">
          <mxGeometry height="140" width="280" x="170" y="430" as="geometry" />
        </mxCell>
        <mxCell id="tdes-168-case" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Случай: TDES_168&lt;br&gt;&lt;br&gt;keySize = TDES_168_KEY_LENGTH&lt;br&gt;keySize = 24 байта&lt;br&gt;&lt;br&gt;Структура ключа:&lt;br&gt;K1 (8 байт) + K2 (8 байт) + K3 (8 байт)&lt;br&gt;= 24 байта = 168 бит&lt;/div&gt;" vertex="1">
          <mxGeometry height="140" width="280" x="1090" y="430" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-12" edge="1" parent="1" source="return-key-size" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="create-array">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="return-key-size" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Возврат размера ключа - keySize&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="320" x="560" y="640" as="geometry" />
        </mxCell>
        <mxCell id="create-array" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;keyBytes = ByteArray(keySize)&lt;/div&gt;&lt;div align=&quot;center&quot;&gt;SecureRandom().nextBytes(keyBytes)&lt;br&gt;&lt;/div&gt;&lt;div align=&quot;center&quot;&gt;&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="260" x="590" y="740" as="geometry" />
        </mxCell>
        <mxCell id="create-entity" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;&lt;br&gt;EncryptionKey(&lt;br&gt;  value = keyBytes,&lt;br&gt;  algorithm = algorithm&lt;/div&gt;&lt;div align=&quot;center&quot;&gt;)&lt;br&gt;&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="220" x="610" y="850" as="geometry" />
        </mxCell>
        <mxCell id="return-success" parent="1" style="parallelogram;whiteSpace=wrap;html=1;fontStyle=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Возврат результата -&amp;nbsp;&lt;br&gt;Result.success(EncryptionKey)&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="240" x="600" y="970" as="geometry" />
        </mxCell>
        <mxCell id="end" parent="1" style="ellipse;whiteSpace=wrap;html=1;fontStyle=1" value="конец" vertex="1">
          <mxGeometry height="80" width="200" x="620" y="1080" as="geometry" />
        </mxCell>
        <mxCell id="e2" edge="1" parent="1" source="start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" target="check-support" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="209.99999999999977" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" edge="1" parent="1" source="check-support" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #446e2c);entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="YgZ0nsd0JDA4WT5Mb-KB-1" value="Да">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" edge="1" parent="1" source="check-algo-type" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #5c79a3);" target="tdes-112-case" value="TDES_112">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e8" edge="1" parent="1" source="check-algo-type" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #5c79a3);" target="tdes-168-case" value="TDES_168">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e9" edge="1" parent="1" source="tdes-112-case" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #5c79a3);" target="return-key-size" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="220" y="670" />
              <mxPoint x="220" y="850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e10" edge="1" parent="1" source="tdes-168-case" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #5c79a3);" target="return-key-size" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1180" y="670" />
              <mxPoint x="1180" y="850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="e14" edge="1" parent="1" source="create-array" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="create-entity" value="">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="720" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e18" edge="1" parent="1" source="create-entity" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #9577a3);" target="return-success" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="e19" edge="1" parent="1" source="return-success" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;" target="end" value="">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-1" parent="1" style="rhombus;whiteSpace=wrap;html=1;align=center;" value="Проверка длины ключа в зависимости от типа 3DES" vertex="1">
          <mxGeometry height="110" width="215" x="593" y="285" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-2" parent="1" style="rounded=1;whiteSpace=wrap;html=1;align=center;" value="&lt;div align=&quot;center&quot;&gt;Бросок исключения:&lt;br&gt;DomainError&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="320" x="890" y="300" as="geometry" />
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-3" edge="1" parent="1" source="YgZ0nsd0JDA4WT5Mb-KB-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #d7817e);exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="YgZ0nsd0JDA4WT5Mb-KB-2" value="Нет">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="820" y="290" as="sourcePoint" />
            <mxPoint x="880" y="355" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-4" edge="1" parent="1" source="YgZ0nsd0JDA4WT5Mb-KB-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=light-dark(#000000, #d7817e);strokeWidth=1;exitX=0.435;exitY=0.964;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;endArrow=classic;endFill=1;" target="end" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1029" y="440" />
              <mxPoint x="1019" y="440" />
              <mxPoint x="1019" y="1180" />
              <mxPoint x="720" y="1180" />
            </Array>
            <mxPoint x="1029.95" y="440" as="sourcePoint" />
            <mxPoint x="720" y="1660" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="YgZ0nsd0JDA4WT5Mb-KB-5" edge="1" parent="1" source="YgZ0nsd0JDA4WT5Mb-KB-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=light-dark(#000000, #446e2c);entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" target="check-algo-type" value="Да">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="770" y="430" as="sourcePoint" />
            <mxPoint x="770" y="455" as="targetPoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
